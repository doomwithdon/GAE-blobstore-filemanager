{%extends "template/base.html" %}
<style type="text/css"></style>
{%block embedpage %} 
	<!-- 一、header -->
    <!-- row -->
    <div class="row">
        <div class="col-lg-12" >
            <!-- page-header完畢後，在mobile可看到hr -->
            <h1 class="page-header">
                Cloud drive <small>Storage Overview</small>
            </h1>
        </div>
    </div>
    <!-- /.row -->
	<!-- ==================== -->
	<!-- 二、雲端空間使用情形 -->
    <!-- 先放著，再來處理-->
    <div class="row" style="display:none" >
        <div class="col-lg-12">
            <div class="panel panel-primary">
                <div class="panel-heading">
                    <h3 class="panel-title"><i class="fa fa-bar-chart-o"></i> Line Graph Example with Tooltips</h3>
                </div>
                <div class="panel-body">
                    <div class="flot-chart">
                        <div class="flot-chart-content" id="flot-line-chart"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- /.row -->
    <div class="row">
        <div class="col-lg-4">
			<h2>Quota details</h2>
            <div class="table-responsive">
                <table class="table table-bordered table-hover table-striped">
                    <thead>
                        <tr>
                            <th width="100">Resource</th>
                            <th>Quota</th>
                        </tr>
                    </thead>
                    <tbody>
						<tr class="success">
							<td>Stored Data</td>
							<td>
								{{wrapper_total_size|countByte}} / 5GB ，
								{{ wrapper_total_size|percentage:"Blob" }}
								<div class="progress">
								  <div class="progress-bar" role="progressbar" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100" style="width: {{ wrapper_total_size|percentage:"Blob" }};">
								  	
								  </div>
								</div>
							</td>									
						</tr>
						<!-- GAE:Incoming Bandwidth，客戶端上傳至雲端 -->
						<tr class="success">
							<td>Upload Bandwidth</td>
							<td>
								{{ Bandwidth_log.Upload_Bandwidth|countByte}} / 1GB ，
								{{ Bandwidth_log.Upload_Bandwidth|percentage:"Bandwidth" }}
								<div class="progress">
								  <div class="progress-bar" role="progressbar" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100" style="width: {{ Bandwidth_log.Upload_Bandwidth|percentage:"Bandwidth" }};">
								  	
								  </div>
								</div>
							</td>									
						</tr>
						<!-- GAE:Outgoing Bandwidth，雲端下載至客戶端 -->
						<tr class="success">
							<td>Download Bandwidth</td>
							<td>
								{{ Bandwidth_log.Download_Bandwidth|countByte}} / 1GB ，
								{{ Bandwidth_log.Download_Bandwidth|percentage:"Bandwidth" }}
								<div class="progress">
								  <div class="progress-bar" role="progressbar" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100" style="width: {{ Bandwidth_log.Download_Bandwidth|percentage:"Bandwidth" }};">
								  	
								  </div>
								</div>
							</td>									
						</tr>
                     </tbody>
                </table>
            </div>	
        </div>


        <!-- flot-pie-chart-one -->
        <div class="col-lg-4">
            <div class="panel panel-primary">
                <div class="panel-heading">
                    <h3 class="panel-title"><i class="fa fa-long-arrow-right"></i>
                    	各用戶使用硬碟空間比例
                    </h3>
                </div>
                <div class="panel-body">
                    <div class="flot-chart">
                        <div class="flot-chart-content" id="flot-pie-chart-one"></div>
                    </div>
                    <div class="text-right">
                        <a href="#">View Details <i class="fa fa-arrow-circle-right"></i></a>
                    </div>
                </div>
            </div>
        </div>
        <!-- /#flot-pie-chart-one -->
        <!-- ==================== -->
        <!--  flot-pie-chart-two  -->
        <div class="col-lg-4">
            <div class="panel panel-green">
                <div class="panel-heading">
                    <h3 class="panel-title"><i class="fa fa-long-arrow-right"></i>
                    	你所上傳的檔案類型的比例
                    </h3>
                </div>
                <div class="panel-body">
                    <div class="flot-chart">
                        <div class="flot-chart-content" id="flot-pie-chart-two"></div>
                    </div>
                    <div class="text-right">
                        <a href="#">View Details <i class="fa fa-arrow-circle-right"></i></a>
                    </div>
                </div>
            </div>            
        </div>
        <!-- /#flot-pie-chart-two -->
        <!-- ==================== -->
    </div>  
	<!-- ======== -->
	<!-- 三、上傳 -->
	{% if user %}
    <!-- 唯有登入狀態，才能啟用後續服務 -->
		<h3>Upload</h3>
		<!--表單 :觸發python上傳動作 -->
		<form id="form" action="{{upload_url}}" method="POST" enctype="multipart/form-data">

			<!--選擇檔案-->
			<input type="file" name="file" multiple="multiple">
			<!--送出-->
			<input type="submit" name="submit" value="Submit">
		</form>

	{% else %}
		Not logged in - <a href="/account">log in</a>
	{% endif %}
	<!-- ======== -->
	<!-- 四、明細 -->
    <div class="row">
        <div class="col-lg-12">
            <h2>Files</h2>
            <div class="table-responsive">
                <table class="table table-bordered table-hover table-striped">
                    <thead>
                        <tr>
                            <th>Title</th>
                            <th>Size</th>
                            <th>Last modified</th>
                            <th>Owner</th>
                            <th>Delete</th>
                        </tr>
                    </thead>
                    <tbody>
						<!-- 1.tbody:blob沒有任何檔案時，則顯示以下訊息 -->
						{% if not wrappers %}
							<tr>
								<td>Null</td>
								<td>-</td>
								<td>-</td>
								<td>-</td>
								<td>-</td>
							</tr>
						{% endif %}
						<!-- 2.tbody:已經有人上傳檔案至blob時，則顯示以下訊息 -->
						{% for wrapper in wrappers %}
							<tr>
								<!-- 1.檔案名稱 -->
								<td><a href="/serve/{{wrapper.blob.key}}">{{wrapper.blob.filename}}</a></td>
								<!-- 2.檔案大小 -->
								<td>{{ wrapper.blob.size|countByte }}</td>
								<!-- 3.上傳時間 -->
								<td>{{wrapper.date|date:"D d M Y g:i:s A"}}</td>
								<!-- 4.上傳作者 -->
								<td>
									<!--如果你是該上傳者，才具有刪除權限 -->
									{% ifequal wrapper.user user %}
										you
									{% else %}
										<small>
											{{wrapper.user.email}}
										</small>
									{% endifequal %}
								</td>
								<td>
									{% ifequal wrapper.user user %}
										<form action="/delete" method="post">
										<input type="hidden" name="key" value="{{wrapper.key}}">
										<input type="submit" value="Delete">
									{% endifequal %}
								</td>
							</tr>
						{% endfor %}
                     </tbody>
                </table>
            </div>
        </div>
    </div>
    <!-- /.row -->
    <div class="row">
        <div class="col-lg-12 text-center">
            <div class="panel panel-default">
                <div class="panel-body">
                    .col-lg-12
                </div>
            </div>
        </div>
    </div>
    <!-- /.row -->
{%endblock%}
{%block extra-jquery-import %}
<!-- Flot Charts JavaScript -->
<!--[if lte IE 8]><script src="js/excanvas.min.js"></script><![endif]-->
<script src="/bootstrap/js/plugins/flot/jquery.flot.js"></script>
<script src="/bootstrap/js/plugins/flot/jquery.flot.tooltip.min.js"></script>
<script src="/bootstrap/js/plugins/flot/jquery.flot.resize.js"></script>
<script src="/bootstrap/js/plugins/flot/jquery.flot.pie.js"></script>
<script type="text/javascript">
//很差的js套件，無法解決去除flot-line-chart的問題
$(document).ready(function() {
    console.log("document ready");
    var offset = 0;
    plot();

    function plot() {
        var sin = [],
            cos = [];
        for (var i = 0; i < 12; i += 0.2) {
            sin.push([i, Math.sin(i + offset)]);
            cos.push([i, Math.cos(i + offset)]);
        }

        var options = {
            series: {
                lines: {
                    show: true
                },
                points: {
                    show: true
                }
            },
            grid: {
                hoverable: true //IMPORTANT! this is needed for tooltip to work
            },
            yaxis: {
                min: -1.2,
                max: 1.2
            },
            tooltip: true,
            tooltipOpts: {
                content: "'%s' of %x.1 is %y.4",
                shifts: {
                    x: -60,
                    y: 25
                }
            }
        };

        var plotObj = $.plot($("#flot-line-chart"), [{
                data: sin,
                label: "sin(x)"
            }, {
                data: cos,
                label: "cos(x)"
            }],
            options);
    }
});

//#flot-pie-chart-one
$(function() {
    var data = [
    {% if user %}            
        {
            label: "you",
            data: {{ owner_usage }}
        },
    {% endif %}
    {% for owner in owner_list %}  
        {% if user != owner.user %}         
        {
            label: "{{owner.user}}",
            data: 5
        },
        {% endif %}
    {% endfor %}

    {
        label: "Series 0",
        data: 1
    }, 
    {
        label: "Series 1",
        data: 3
    }, {
        label: "Series 2",
        data: 9
    }, {
        label: "Series 3",
        data: 20
    },
    ];

    var plotObj = $.plot($("#flot-pie-chart-one"), data, {
        series: {
            pie: {
                show: true
            }
        },
        grid: {
            hoverable: true
        },
        tooltip: true,
        tooltipOpts: {
            content: "%p.0%, %s", // show percentages, rounding to 2 decimal places
            shifts: {
                x: 20,
                y: 0
            },
            defaultTheme: false
        }
    });

});

//#flot-pie-chart-two
$(function() {

    var data = [{
        label: "Series 0",
        data: 1
    }, {
        label: "Series 1",
        data: 3
    }, {
        label: "Series 2",
        data: 9
    }, {
        label: "Series 3",
        data: 20
    }];

    var plotObj = $.plot($("#flot-pie-chart-two"), data, {
        series: {
            pie: {
                show: true
            }
        },
        grid: {
            hoverable: true
        },
        tooltip: true,
        tooltipOpts: {
            content: "%p.0%, %s", // show percentages, rounding to 2 decimal places
            shifts: {
                x: 20,
                y: 0
            },
            defaultTheme: false
        }
    });

});
</script>


{%endblock%}